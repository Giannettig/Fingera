{
    "collab_server" : "",
    "contents" : "\n#Install the libraries\nlibrary(httr)\nlibrary(data.table)\nlibrary(dplyr)\nlibrary(xml2)\nlibrary(purrr)\n\n#=======BASIC INFO ABOUT THE Fingera EXTRACTOR========#\n\n#=======CONFIGURATION========#\n## initialize application\nlibrary('keboola.r.docker.application')\napp <- DockerApplication$new('/data/')\n\napp$readConfig()\n\n## access the supplied value of 'myParameter'\npassword<-app$getParameters()$`#password`\nuser<-app$getParameters()$user\n# start_date<-app$getParameters()$from\n# end_date<-app$getParameters()$to\nurl<-app$getParameters()$url\n\n##Catch config errors\n\nif(is.null(user)) stop(\"enter your username in the user config field\")\nif(is.null(password)) stop(\"enter your password in the #password config field\")\n# if(is.null(start_date)|is.null(end_date)) {\n#   warning(\"You entered an invalid date range, the extract will extract data from last 1 day\")\n#   end_date<-Sys.Date()\n#   start_date<-end_date-1\n#   end_date<-as.POSIXct(end_date)\n#   start_date<-as.POSIXct(start_date)\n# }\n# from<-format(as.Date(start_date), \"%d.%m.%Y\")\n# to<-format(as.Date(end_date), \"%d.%m.%Y\")\n\n\n# List of available endpoints\n# day_schedules\n# event_categories\n# fingera_stations\n# groups\n# local_settings\n# settings\n# terminals\n# time_logs\n# user_accounts\n# users\n\n##Now process the request\n\n\ngetStats<-function(api,endpoint){\n  \n  url<-paste0(api,endpoint)\n  \n  r <-\n    RETRY(\n      \"GET\",\n      url,\n      config = authenticate(user,password),\n      times = 3,\n      pause_base = 3,\n      pause_cap = 10\n    )\n  \n  res<-content(r,\"text\",encoding = \"UTF-8\")%>%fromJSON\n  \n}\n\ngetTimelogs<-function(api,user_id){\n  \n  url<-paste0(api,\"time_logs\")\n  \n  args<-list(\n    \"user_id\"=user_id\n  )\n  \n  r <-\n    RETRY(\n      \"GET\",\n      url,\n      config = authenticate(user,password),\n      times = 3,\n      pause_base = 3,\n      pause_cap = 10,\n      query = args\n    )\n  \n  res<-content(r,\"text\",encoding = \"UTF-8\")%>%fromJSON\n  \n}\n\n#iterate over users\nuser_ids<-getStats(api,\"users\")%>%filter(as.Date(substr(created_at,1,10))<as.Date(end_date))%>%select(id)%>%.[,1]\n\ntest<-user_ids[1:10]\n\nres<-map_df(user_ids,function(x){getTimelogs(api,x)})\n\nwrite_csv(res,\"out/tables/time_logs.csv\")\n",
    "created" : 1507656925824.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4246640613",
    "id" : "4D4DD5FC",
    "lastKnownWriteTime" : 1507656961,
    "last_content_update" : 1507656961925,
    "path" : "~/OneDrive/Scripts/Fingera/main.R",
    "project_path" : "main.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}